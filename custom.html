<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <title>Custom</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <script src="js/settings.js"></script>
  <script src="js/auth.js"></script>
</head>
<body class="page-custom">
  <header class="site-header" id="global-header">
    <div class="site-header__profile">
      <div class="site-header__avatar" id="header-avatar" role="img" aria-label="Foto do jogador" data-initial="J"></div>
      <div class="site-header__text">
        <span class="site-header__name" id="header-username">Jogador</span>
        <span class="site-header__level" id="header-level">N√≠vel 1</span>
      </div>
    </div>
    <div class="site-header__actions">
      <button id="login-btn" class="site-header__button" type="button">Entrar</button>
    </div>
  </header>
  <div id="custom-content" style="text-align:center;margin-top:50px;"></div>
  <div id="login-flow" class="login-flow hidden" role="dialog" aria-modal="true" aria-labelledby="login-flow-title" aria-hidden="true">
    <div class="login-flow__panel">
      <img src="selos%20modos%20de%20jogo/logoitalk2.png" alt="Logo American Life" class="login-flow__logo" width="70" height="70">
      <h1 id="login-flow-title" class="login-flow__title">Bem-vindo</h1>
      <form id="login-flow-form" class="login-flow__form" autocomplete="off" novalidate>
        <div class="login-flow__step login-flow__step--active" data-step="username">
          <label for="login-flow-username">Nome de usu√°rio</label>
          <input type="text" id="login-flow-username" name="login-flow-username" maxlength="40" required>
          <button type="button" class="login-flow__submit" data-action="next">Continuar</button>
        </div>
        <div class="login-flow__step" data-step="password">
          <label for="login-flow-password">Senha</label>
          <input type="password" id="login-flow-password" name="login-flow-password" required>
          <button type="button" class="login-flow__submit" data-action="next">Continuar</button>
        </div>
        <div class="login-flow__step" data-step="confirm">
          <label for="login-flow-confirm">Confirmar senha</label>
          <input type="password" id="login-flow-confirm" name="login-flow-confirm" required>
          <button type="submit" class="login-flow__submit">Criar conta</button>
        </div>
        <p id="login-flow-error" class="login-flow__error" role="alert"></p>
      </form>
    </div>
  </div>
  <script>
    function formatTime(ms) {
      const sec = Math.floor(ms / 1000);
      const min = Math.floor(sec / 60);
      const s = sec % 60;
      return `${min}m ${s}s`;
    }
    function createRankingTable(data, color, columns) {
      const table = document.createElement('table');
      table.className = `ranking-table ${color}`;
      const header = document.createElement('tr');
      header.innerHTML = columns.map(c => `<th>${c.label}</th>`).join('');
      table.appendChild(header);
      data.forEach(item => {
        const row = document.createElement('tr');
        columns.forEach(c => {
          const td = document.createElement('td');
          td.textContent = item[c.field];
          row.appendChild(td);
        });
        table.appendChild(row);
      });
      return table;
    }
    document.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('custom-content');
      const statsData = JSON.parse(localStorage.getItem('modeStats') || '{}');
      for (let i = 1; i <= 6; i++) {
        const stats = statsData[i] || {};
        const totalTime = stats.totalTime || 0;
        const total = stats.totalPhrases || 0;
        const correct = stats.correct || 0;
        const wrong = stats.wrong || 0;
        const report = stats.report || 0;
        const acc = total ? ((correct / total) * 100).toFixed(2) : '0';
        const avg = total ? formatTime(totalTime / total) : '0s';
        const reportPerc = total ? ((report / total) * 100).toFixed(2) : '0';
        const section = document.createElement('div');
        section.innerHTML = `
          <h1 class="custom-title">Modo ${i} - Resultados</h1>
          <div class="custom-info">Frases totais: ${total}</div>
          <div class="custom-info">Tempo de jogo: ${formatTime(totalTime)}</div>
          <div class="custom-info">Frases acertadas: ${correct}</div>
          <div class="custom-info">Frases erradas: ${wrong}</div>
          <div class="custom-info">Porcentagem de acertos: ${acc}%</div>
          <div class="custom-info">M√©dia de tempo por frase: ${avg}</div>
          <div class="custom-info">Uso de reportar: ${reportPerc}%</div>
        `;
        const red = stats.wrongRanking || [];
        const green = stats.reportRanking || [];
        if (red.length) {
          const title = document.createElement('h2');
          title.textContent = 'Ranking vermelho';
          title.className = 'ranking-title-red';
          section.appendChild(title);
          section.appendChild(createRankingTable([...red].sort((a,b) => b.count - a.count), 'red', [
            { field: 'expected', label: 'Esperado' },
            { field: 'input', label: 'Entrada' },
            { field: 'folder', label: 'Pasta' },
            { field: 'count', label: 'Erros' }
          ]));
        }
        if (green.length) {
          const title = document.createElement('h2');
          title.textContent = 'Ranking verde lim√£o';
          title.className = 'ranking-title-lime';
          section.appendChild(title);
          section.appendChild(createRankingTable(green, 'lime', [
            { field: 'expected', label: 'Esperado' },
            { field: 'input', label: 'Entrada' },
            { field: 'folder', label: 'Pasta' },
            { field: 'level', label: 'N√≠vel de reports' }
          ]));
        }
        container.appendChild(section);
      }
      const levelTitle = document.createElement('h1');
      levelTitle.className = 'custom-title';
      levelTitle.textContent = 'Detalhe dos n√≠veis';
      container.appendChild(levelTitle);
      const details = JSON.parse(localStorage.getItem('levelDetails') || '[]');
      if (details.length) {
        const table = document.createElement('table');
        table.className = 'ranking-table';
        const header = document.createElement('tr');
        header.innerHTML = '<th>N√≠vel</th><th>Precis√£o</th><th>Velocidade</th><th>Reports</th>';
        table.appendChild(header);
        details.forEach(d => {
          const row = document.createElement('tr');
          row.innerHTML = `<td>${d.level}</td><td>${d.accuracy}%</td><td>${d.speed}%</td><td>${d.reports}%</td>`;
          table.appendChild(row);
        });
        container.appendChild(table);
      }
    });
  </script>
  <footer class="page-footer">
    <nav id="main-nav">
      <a href="index.html" class="nav-item" aria-label="Home">
        <span aria-hidden="true">‚ñ∂</span>
        <span class="sr-only">Home</span>
      </a>
      <a href="fun.html" class="nav-item" aria-label="Fun">
        <span aria-hidden="true">üåê</span>
        <span class="sr-only">Fun</span>
      </a>
      <a href="play.html" class="nav-item" aria-label="Play">
        <span aria-hidden="true">üìä</span>
        <span class="sr-only">Play</span>
      </a>
      <a href="custom.html" class="nav-item active" aria-label="Custom">
        <span aria-hidden="true">üí†</span>
        <span class="sr-only">Custom</span>
      </a>
      <a href="ranking.html" class="nav-item" aria-label="Ranking">
        <span aria-hidden="true">üèÜ</span>
        <span class="sr-only">Ranking</span>
      </a>
      <div class="nav-item--user">
        <button class="nav-item nav-item__trigger" type="button" aria-expanded="false" aria-controls="user-menu">
          <span aria-hidden="true">üë®üèª</span>
          <span class="sr-only">Usu√°rio</span>
        </button>
        <div id="user-menu" class="nav-item__menu" hidden>
          <a href="perfil.html" class="nav-item__menu-link">Perfil</a>
          <button id="logout-btn" class="nav-item__menu-link nav-item__menu-link--button" type="button">Sair</button>
        </div>
      </div>
    </nav>
  </footer>
</body>
</html>
